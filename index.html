<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Document Scanner</title>
  <style>
    body { font-family: sans-serif; background: #121212; color: white; padding: 20px; }
    #chat-box { height: 300px; overflow-y: auto; border: 1px solid #333; padding: 10px; margin-bottom: 10px; }
    .controls { display: flex; gap: 10px; }
    input[type="text"] { flex: 1; padding: 10px; }
    button { padding: 10px 20px; cursor: pointer; background: #7c83fd; color: white; border: none; }
    #file-name { font-size: 12px; color: #aaa; margin-top: 5px; }
  </style>
</head>
<body>
  <h2>üìÑ AI PDF Analyzer</h2>
  <div id="chat-box"></div>
  
  <input type="file" id="file-input" accept="application/pdf" style="display:none">
  <button onclick="document.getElementById('file-input').click()">üìÅ Upload PDF</button>
  <div id="file-name">No file selected</div>

  <div class="controls" style="margin-top:15px;">
    <input type="text" id="user-input" placeholder="Ask a question about the PDF...">
    <button id="send-btn">Analyze</button>
  </div>

  <script>
    let currentPdfBase64 = null;

    document.getElementById('file-input').onchange = function(e) {
      const file = e.target.files[0];
      document.getElementById('file-name').textContent = "Selected: " + file.name;
      const reader = new FileReader();
      reader.onload = function() {
        currentPdfBase64 = reader.result.split(',')[1];
      };
      reader.readAsDataURL(file);
    };

    async function sendRequest() {
      const text = document.getElementById('user-input').value;
      const box = document.getElementById('chat-box');
      box.innerHTML += `<div><b>User:</b> ${text}</div>`;
      
      const res = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: text, pdfBase64: currentPdfBase64 })
      });
      
      const data = await res.json();
      box.innerHTML += `<div style="color:#7c83fd"><b>AI:</b> ${data.reply}</div>`;
    }

    document.getElementById('send-btn').onclick = sendRequest;
  </script>
</body>
</html>
